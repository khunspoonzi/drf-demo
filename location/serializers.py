# ┌─────────────────────────────────────────────────────────────────────────────────────
# │ DJANGO REST IMPORTS
# └─────────────────────────────────────────────────────────────────────────────────────

from dynamic_rest.fields import DynamicRelationField
from dynamic_rest.serializers import DynamicModelSerializer

# ┌─────────────────────────────────────────────────────────────────────────────────────
# │ PROJECT IMPORTS
# └─────────────────────────────────────────────────────────────────────────────────────

from location.models import City, Country


# ┌─────────────────────────────────────────────────────────────────────────────────────
# │ CITY SERIALIZER
# └─────────────────────────────────────────────────────────────────────────────────────


class CitySerializer(DynamicModelSerializer):

    # ┌─────────────────────────────────────────────────────────────────────────────────
    # │ CLASS ATTRIBUTES
    # └─────────────────────────────────────────────────────────────────────────────────

    country = DynamicRelationField("CountrySerializer")

    # ┌─────────────────────────────────────────────────────────────────────────────────
    # │ META
    # └─────────────────────────────────────────────────────────────────────────────────

    class Meta:
        """ Meta Class """

        # ┌─────────────────────────────────────────────────────────────────────────────
        # │ MODEL
        # └─────────────────────────────────────────────────────────────────────────────

        model = City
        name = "city"

        # ┌─────────────────────────────────────────────────────────────────────────────
        # │ FIELDS
        # └─────────────────────────────────────────────────────────────────────────────

        fields = ("id", "country", "name", "population", "latitude", "longitude")


# ┌─────────────────────────────────────────────────────────────────────────────────────
# │ COUNTRY SERIALIZER
# └─────────────────────────────────────────────────────────────────────────────────────


class CountrySerializer(DynamicModelSerializer):

    # ┌─────────────────────────────────────────────────────────────────────────────────
    # │ CLASS ATTRIBUTES
    # └─────────────────────────────────────────────────────────────────────────────────

    # Define upward foreign key fields
    capital = DynamicRelationField("CitySerializer")
    currency = DynamicRelationField("currency.serializers.CurrencySerializer")

    # Define downward foreign key fields
    cities = DynamicRelationField("CitySerializer", many=True, deferred=True)

    # ┌─────────────────────────────────────────────────────────────────────────────────
    # │ META
    # └─────────────────────────────────────────────────────────────────────────────────

    class Meta:
        """ Meta Class """

        # ┌─────────────────────────────────────────────────────────────────────────────
        # │ MODEL
        # └─────────────────────────────────────────────────────────────────────────────

        model = Country
        name = "country"

        # ┌─────────────────────────────────────────────────────────────────────────────
        # │ FIELDS
        # └─────────────────────────────────────────────────────────────────────────────

        fields = (
            "id",
            "capital",
            "currency",
            "name",
            "name_native",
            "iso2",
            "iso3",
            "population",
            "latitude",
            "longitude",
            "is_un_member",
            "is_un_member_at",
            "flag",
            "cities",
        )
